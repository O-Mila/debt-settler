{"ast":null,"code":"import _defineProperty from \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/src/components/item/AddItem.js\";\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport { Redirect } from 'react-router';\n\nvar AddItem =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AddItem, _Component);\n\n  function AddItem() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AddItem);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AddItem)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      name: '',\n      users: [],\n      paid: [],\n      received: {\n        amounts: [],\n        benefits: []\n      },\n      total: Number,\n      redirect: false,\n      item_id: ''\n    };\n\n    _this.handleNameChange = function (e) {\n      _this.setState(_defineProperty({}, e.target.name, e.target.value));\n\n      console.log(_this.state);\n    };\n\n    _this.handlePaymentsChange = function (i, e) {\n      e.persist();\n\n      _this.setState(function (state) {\n        var paid = state.paid.map(function (payment, j) {\n          if (i === j) return e.target.value;\n          return payment;\n        });\n        return {\n          paid: paid\n        };\n      });\n\n      _this.setState(function (state) {\n        var total = 0;\n        var paid = state.paid;\n\n        for (var k = 0; k < paid.length; k++) {\n          total += Number(paid[k]);\n        }\n\n        total = Math.round(total * 100) / 100;\n        return {\n          total: total\n        };\n      });\n\n      _this.setState(function (state) {\n        var total = state.total,\n            received = state.received;\n        var consumers = received.benefits.filter(function (benefit) {\n          return benefit;\n        }).length;\n        console.log(consumers);\n        var newAmounts = received.amounts.map(function (amount, i) {\n          if (received.benefits[i]) return Math.round(total / consumers * 100) / 100;\n          return 0;\n        });\n        return {\n          received: {\n            amounts: newAmounts,\n            benefits: received.benefits\n          }\n        };\n      });\n\n      console.log(_this.state);\n    };\n\n    _this.handleConsumptionsChange = function (i, e) {\n      e.persist();\n      console.log(e.target);\n\n      _this.setState(function (state) {\n        var received = state.received,\n            total = state.total;\n        var newBenefits = received.benefits.map(function (benefit, j) {\n          if (i === j) {\n            if (e.target.checked) return true;\n            return false;\n          }\n\n          return benefit;\n        });\n        var consumers = newBenefits.filter(function (benefit) {\n          return benefit;\n        }).length;\n        console.log(consumers);\n        var newAmounts = received.amounts.map(function (amount, j) {\n          if (newBenefits[j]) return Math.round(total / consumers * 100) / 100;\n          return 0;\n        });\n        return {\n          received: {\n            amounts: newAmounts,\n            benefits: newBenefits\n          }\n        };\n      });\n\n      console.log(_this.state);\n    };\n\n    _this.addItem = function (e) {\n      e.preventDefault();\n      var _this$state = _this.state,\n          name = _this$state.name,\n          users = _this$state.users,\n          paid = _this$state.paid,\n          received = _this$state.received,\n          total = _this$state.total;\n\n      if (total > 0) {\n        var group_id = _this.props.match.params.group_id;\n        axios.post(\"http://localhost:8080/api/groups/\".concat(group_id, \"/items\"), {\n          name: name,\n          users: users,\n          paid: paid,\n          received: received.amounts,\n          group_id: group_id\n        }).then(function (response) {\n          console.log(response);\n          var item_id = response.data._id;\n\n          _this.setState({\n            redirect: true,\n            item_id: item_id\n          });\n        });\n      } else {\n        console.log('Someone has to pay!!!');\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(AddItem, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var group_id = this.props.match.params.group_id;\n      axios.get(\"http://localhost:8080/api/groups/\".concat(group_id)).then(function (response) {\n        _this2.setState({\n          users: response.data.group.users\n        });\n\n        var length = _this2.state.users.length;\n\n        for (var i = 0; i < length; i++) {\n          _this2.setState(function (state) {\n            var paid = state.paid.concat(0);\n            var received = {\n              amounts: state.received.amounts.concat(0),\n              benefits: state.received.benefits.concat(true)\n            };\n            return {\n              paid: paid,\n              received: received,\n              total: 0\n            };\n          });\n        }\n\n        console.log(_this2.state);\n      }).catch(function (err) {\n        console.log(err);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state2 = this.state,\n          name = _this$state2.name,\n          users = _this$state2.users,\n          total = _this$state2.total,\n          received = _this$state2.received,\n          redirect = _this$state2.redirect,\n          item_id = _this$state2.item_id;\n      var group_id = this.props.match.params.group_id;\n\n      if (redirect) {\n        return React.createElement(Redirect, {\n          to: \"/groups/\".concat(group_id, \"/items/\").concat(item_id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        });\n      }\n\n      var payers = React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, users.map(function (user, i) {\n        return React.createElement(\"tr\", {\n          key: user._id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          },\n          __self: this\n        }, user.username), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"number\",\n          placeholder: \"0.00\",\n          name: \"paid\",\n          min: \"0\",\n          pattern: \"^\\\\d*(\\\\.\\\\d{0,2})?$\",\n          step: \"0.01\",\n          onChange: function onChange(e) {\n            return _this3.handlePaymentsChange(i, e);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        })));\n      }));\n      var consumers = React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, users.map(function (user, i) {\n        return React.createElement(\"tr\", {\n          key: user._id,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157\n          },\n          __self: this\n        }, React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158\n          },\n          __self: this\n        }, user.username), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159\n          },\n          __self: this\n        }, received.amounts[i]), React.createElement(\"td\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        }, React.createElement(\"input\", {\n          type: \"checkbox\",\n          name: \"received\",\n          checked: received.benefits[i],\n          onChange: function onChange(e) {\n            return _this3.handleConsumptionsChange(i, e);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        })));\n      }));\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(\"form\", {\n        onSubmit: this.addItem,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        type: \"text\",\n        onChange: this.handleNameChange,\n        name: \"name\",\n        placeholder: \"item name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }, name), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178\n        },\n        __self: this\n      }, \"Total: \", total), React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, \"Payers\"), payers, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, \"Consumers\"), consumers, React.createElement(\"button\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }, \"Add item\")));\n    }\n  }]);\n\n  return AddItem;\n}(Component);\n\nexport default AddItem;","map":{"version":3,"sources":["/home/oriol/Documents/PROGRAMMING/Exercicis/mern-stepbystep/src/components/item/AddItem.js"],"names":["React","Component","axios","Redirect","AddItem","state","name","users","paid","received","amounts","benefits","total","Number","redirect","item_id","handleNameChange","e","setState","target","value","console","log","handlePaymentsChange","i","persist","map","payment","j","k","length","Math","round","consumers","filter","benefit","newAmounts","amount","handleConsumptionsChange","newBenefits","checked","addItem","preventDefault","group_id","props","match","params","post","then","response","data","_id","get","group","concat","catch","err","payers","user","username"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport axios from 'axios';\nimport { Redirect } from 'react-router';\n\nclass AddItem extends Component {\n\tstate = {\n\t\tname: '',\n\t\tusers: [],\n\t\tpaid: [],\n\t\treceived: {\n\t\t\tamounts: [], \n\t\t\tbenefits: []\n\t\t},\n\t\ttotal: Number,\n\t\tredirect: false,\n\t\titem_id: ''\n\t}\n\tcomponentDidMount(){\n\t\tconst { group_id } = this.props.match.params;\n\t\taxios.get(`http://localhost:8080/api/groups/${group_id}`)\n\t\t.then(response => {\n\t\t\tthis.setState({\n\t\t\t\tusers: response.data.group.users\n\t\t\t})\n\t\t\tconst { length } = this.state.users\n\t\t\tfor(let i = 0; i < length; i++){\n\t\t\t\tthis.setState(state => {\n\t\t\t\t\tconst paid = state.paid.concat(0);\n\t\t\t\t\tconst received = { \n\t\t\t\t\t\tamounts: state.received.amounts.concat(0), \n\t\t\t\t\t\tbenefits: state.received.benefits.concat(true) \n\t\t\t\t\t}\n\t\t\t\t\treturn { paid, received, total: 0 }\n\t\t\t\t})\n\t\t\t}\n\t\t\tconsole.log(this.state)\n\t\t})\n\t\t.catch(err => {\n\t\t\tconsole.log(err);\n\t\t})\n\t}\n\thandleNameChange = e => {\n    \tthis.setState({\n      \t\t[e.target.name]: e.target.value\n    \t})\n    \tconsole.log(this.state)\n\t}\n\thandlePaymentsChange = (i, e) => {\n\t\te.persist()\n\t\tthis.setState(state => {\n\t\t\tconst paid = state.paid.map((payment, j) => {\n\t\t\t\tif (i === j) return e.target.value\n\t\t\t\treturn payment\n\t\t\t})\n\t\t\treturn { paid }\n\t\t})\n\t\tthis.setState(state => {\n\t\t\tvar total = 0;\n\t\t\tconst { paid } = state\n\t\t\tfor(let k = 0; k < paid.length; k++){\n\t\t\t\ttotal += Number(paid[k])\n\t\t\t}\n\t\t\ttotal = Math.round(total*100)/100\n\t\t\treturn { total }\n\t\t})\n\t\tthis.setState(state => {\n\t\t\tconst { total, received } = state\n\t\t\tconst consumers = received.benefits.filter(benefit => benefit).length\n\t\t\tconsole.log(consumers)\n\t\t\tconst newAmounts = received.amounts.map((amount, i) => {\n\t\t\t\tif(received.benefits[i]) return Math.round(total/consumers*100)/100\n\t\t\t\treturn 0\n\t\t\t})\n\t\t\treturn { \n\t\t\t\treceived: { \n\t\t\t\t\tamounts: newAmounts, \n\t\t\t\t\tbenefits: received.benefits \n\t\t\t\t} \n\t\t\t}\n\t\t})\n\t\tconsole.log(this.state)\n\t}\n\thandleConsumptionsChange = (i, e) => {\n\t\te.persist()\n\t\tconsole.log(e.target)\n\t\tthis.setState(state => {\n\t\t\tconst { received, total } = state\n\t\t\tconst newBenefits = received.benefits.map((benefit, j) => {\n\t\t\t\tif(i === j){\n\t\t\t\t\tif(e.target.checked) return true\n\t\t\t\t\treturn false\t\t\n\t\t\t\t}\n\t\t\t\treturn benefit\n\t\t\t})\n\t\t\tconst consumers = newBenefits.filter(benefit => benefit).length\n\t\t\tconsole.log(consumers)\n\t\t\tconst newAmounts = received.amounts.map((amount, j) => {\n\t\t\t\tif(newBenefits[j]) return Math.round(total/consumers*100)/100\n\t\t\t\treturn 0\n\t\t\t})\n\t\t\treturn {\n\t\t\t\treceived: {\n\t\t\t\t\tamounts: newAmounts,\n\t\t\t\t\tbenefits: newBenefits\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\tconsole.log(this.state)\n\t}\n\taddItem = e => {\n\t\te.preventDefault()\n\t\tconst { name, users, paid, received, total } = this.state\n\t\tif(total > 0){\n\t\t\tconst { group_id } = this.props.match.params\n\t\t\taxios.post(`http://localhost:8080/api/groups/${group_id}/items`,\n\t\t\t\t{ name, users, paid, received: received.amounts, group_id })\n\t\t\t.then(response => {\n\t\t\t\tconsole.log(response)\n\t\t\t\tconst item_id  = response.data._id\n\t\t\t\tthis.setState({\n\t\t\t\t\tredirect: true,\n\t\t\t\t\titem_id: item_id\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\telse {\n\t\t\tconsole.log('Someone has to pay!!!')\n\t\t}\n\t}\n\trender(){\n\t\tconst { name, users, total, received, redirect, item_id } = this.state;\n\t\tconst { group_id } = this.props.match.params; \n\t\tif(redirect){\n    \t\treturn <Redirect to={`/groups/${group_id}/items/${item_id}`} />\n    \t}\n\t\tconst payers = (\n\t\t\t<div>\n\t\t\t\t{\n\t\t\t\t\tusers.map((user, i) => {\n\t\t\t\t\t\treturn  <tr key={user._id}>\n\t\t\t\t\t\t\t\t\t<td>{user.username}</td>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<input type='number' placeholder='0.00' name='paid' min='0'\n\t\t\t\t\t\t\t\t\t\tpattern=\"^\\d*(\\.\\d{0,2})?$\"\n\t\t\t\t\t\t\t\t\t\tstep='0.01' onChange={e => this.handlePaymentsChange(i, e)} />\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\n\t\tconst consumers = (\n\t\t\t<div>\n\t\t\t\t{\n\t\t\t\t\tusers.map((user, i) => {\n\t\t\t\t\t\treturn  <tr key={user._id}>\n\t\t\t\t\t\t\t\t\t<td>{user.username}</td>\n\t\t\t\t\t\t\t\t\t<td>{received.amounts[i]}</td>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<input type='checkbox' name='received' \n\t\t\t\t\t\t\t\t\t\tchecked={received.benefits[i]}\n\t\t\t\t\t\t\t\t\t\t onChange={e => this.handleConsumptionsChange(i,e)} \n\t\t\t\t\t\t\t\t\t\t />\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t</div>\n\t\t)\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<form onSubmit={this.addItem}>\n\t\t\t\t\t<input type='text' onChange={this.handleNameChange} \n\t\t\t\t\t\tname='name' placeholder='item name' />\n\t\t\t\t\t<div>{name}</div>\n\t\t\t\t\t<h3>Total: {total}</h3>\n\t\t\t\t\t<h3>Payers</h3>\n\t\t\t\t\t{payers}\n\t\t\t\t\t<h3>Consumers</h3>\n\t\t\t\t\t{consumers}\n\t\t\t\t\t<button>Add item</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default AddItem;"]},"metadata":{},"sourceType":"module"}